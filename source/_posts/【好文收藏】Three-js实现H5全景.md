---
title: ã€å¥½æ–‡æ”¶è—ã€‘Three.jså®ç°H5å…¨æ™¯
date: 2021-08-05 19:48:55
tags:
	- å¥½æ–‡æ”¶è—
	- å‰ç«¯
---



> ä½œè€…ï¼šazuo
>
> é“¾æ¥ï¼šhttps:*//juejin.cn/post/6968263858309824526*
>
> æ¥æºï¼šæ˜é‡‘
>
> æ–‡æœ«æ˜¯æˆ‘å¯¹æ–‡ç« çš„è¡¥å……ã€‚



![img](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f358b9a8c06422fb9faf4fc81396318~tplv-k3u1fbpfcp-zoom-crop-mark:652:652:652:367.awebp)

# ä¸åˆ°30è¡Œä»£ç å®ç°ä¸€ä¸ªé…·ç‚«H5å…¨æ™¯

**å‰è¨€**ï¼š æœ¬æ–‡å°†å›´ç»•ï¼š**äº†è§£ä»€ä¹ˆæ˜¯å…¨æ™¯ --> æ€ä¹ˆæ„æˆå…¨æ™¯ --> å…¨æ™¯äº¤äº’åŸç†**æ¥è¿›è¡Œè®²è§£ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä»é›¶åŸºç¡€å®ç°ä¸€ä¸ªé…·ç‚«çš„Webå…¨æ™¯ï¼Œå¹¶è®²è§£å…¶ä¸­çš„åŸç†ã€‚å°ç™½ä¹Ÿèƒ½å­¦ä¹ ï¼Œå»ºè®®æ”¶è—å­¦ä¹ ,æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åœ¨è¯„è®ºåŒºè®¨è®ºï¼Œç¬”è€…ç»å¸¸æŸ¥çœ‹å¹¶å›å¤ã€‚

## ä¸€ã€äº†è§£ä»€ä¹ˆæ˜¯å…¨æ™¯

### 1.1 å…¨æ™¯å®šä¹‰

å®šä¹‰ï¼šå…¨æ™¯æ˜¯æŸä¸€ç©ºé—´çš„*å…¨éƒ¨*æ™¯è‰²ã€‚

é€šä¿—åœ°è¯´ï¼šå¤§å®¶éƒ½æ‹è¿‡ç…§ç‰‡ï¼Œé‚£æˆ‘ä»¬æƒ³æƒ³ä¸€ä¸‹æ‹ç…§ç‰‡çš„è¿‡ç¨‹ï¼šç«™åœ¨æŸä¸ªç©ºé—´ï¼Œæ‹¿ç€ç›¸æœºï¼Œæœç€æŸä¸€è§’åº¦æ‹æ‘„ï¼Œå°±å¯ä»¥è·å¾—è¿™è§’åº¦çš„æ™¯è‰²ç…§ç‰‡äº†ï¼Œè€Œå…¨æ™¯å‘¢ï¼Ÿæ˜¯ç«™åœ¨æŸä¸ªç©ºé—´ï¼Œæ‹¿ç€ç›¸æœºç«™ç€ï¼Œæœç€360è§’åº¦æ‹æ‘„ï¼Œè·å¾—æ‰€æœ‰è§’åº¦çš„æ™¯è‰²ç…§ç‰‡ï¼Œç»„åˆèµ·æ¥ï¼Œå†é€šè¿‡ä¸“é—¨çš„æŠ€æœ¯å±•ç¤ºç»™å¤§å®¶çœ‹çš„å¯äº¤äº’çš„ç…§ç‰‡ã€‚

å…¨æ™¯ç¤ºä¾‹ï¼š

![Jietu20210527-113413-HD.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12892de7a98c4665b59000aac696dc44~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

ä½“éªŒäºŒç»´ç ï¼ˆæ”¯æŒå¾®ä¿¡æ‰«ç ï¼‰ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66c248b391284d6eb20e21eebf7e6683~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

### 1.2 å…¨æ™¯å±•ç¤ºæ–¹å¼

å…¨æ™¯çš„å±•ç¤ºæ–¹å¼æœ‰å¾ˆå¤šä¸­ï¼Œæ¯”å¦‚ï¼šæŸ±ä½“å…¨æ™¯ã€ç«‹æ–¹ä½“å…¨æ™¯ã€çƒä½“å…¨æ™¯ç­‰ç­‰â€¦â€¦![Jietu20210527-152042-HD.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6b97026b78a4295991ce29105ca99e5~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

***æœ€æœ€é€šä¿—çš„ç†è§£ï¼šç”¨ä¸€ä¸ªå¤§çš„çº¸ç®±å¥—åœ¨å¤´ä¸Šï¼Œçœ‹çš„åœºæ™¯ï¼ˆè¿™ç§å±•ç¤ºæ–¹å¼å°±æ˜¯ç«‹æ–¹ä½“å…¨æ™¯ï¼‰***

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61655cc8becc4a69ada34e6658fc1d3e~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

æŸ±ä½“ã€ç«‹æ–¹ä½“å­˜åœ¨äº¤å‰åŒºåŸŸï¼Œç•Œé¢åœ¨äº¤å‰åŒºåŸŸäº¤äº’ä¼šå‘ˆç°æ­»è§’ã€‚æ‰€ä»¥ï¼Œæœ€å¥½å…¨æ™¯å‘ˆç°æ–¹å¼æ˜¯**çƒä½“å…¨æ™¯**ï¼Œ360åº¦æ— æ­»è§’ï¼Œæœ¬æ–‡å°†ä»¥çƒä½“å…¨æ™¯æ¥è®²è§£ã€‚

## äºŒã€æ€ä¹ˆæ„æˆå…¨æ™¯

### 2.1 è®¤è¯†ThreeJS

ç›®å‰ä¸»æµå…¨æ™¯çš„å‰ç«¯å®ç°æ–¹å¼ï¼š

| å®ç°æ–¹å¼         | è´¹ç”¨ | æ˜¯å¦å¼€æº | å­¦ä¹ æˆæœ¬ | å¼€å‘éš¾åº¦ | å…¼å®¹æ€§                    | æ‰©å±• | æ€§èƒ½ |
| ---------------- | ---- | -------- | -------- | -------- | ------------------------- | ---- | ---- |
| CSSS 3D          | å…è´¹ | æ˜¯       | ä¸­       | éš¾       | æ”¯æŒCSS3Dçš„æµè§ˆå™¨         | æ˜“   | ä½   |
| ThreeJS          | å…è´¹ | æ˜¯       | é«˜       | ä¸­       | æ”¯æŒWebGLçš„éƒ¨åˆ†æµè§ˆå™¨     | æ˜“   | é«˜   |
| å…¨æ™¯å·¥å…·(Krpano) | æ”¶è´¹ | å¦       | æ˜“       | æ—        | æ”¯æŒflashå’Œcanvasçš„æµè§ˆå™¨ | éš¾   | ä¸­   |

ä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚ï¼ˆçæŠ˜è…¾ï¼‰å‰ç«¯å¼€å‘ï¼Œå½“ç„¶è¦é€‰æ‹©**ThreeJS**ï¼ï¼ï¼

ThreeJSæ˜¯Threeï¼ˆ3Dï¼‰+JSï¼ˆJavaScriptï¼‰ï¼Œå®ƒå°è£…äº†åº•å±‚çš„WebGLæ¥å£ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸äº†è§£å›¾å½¢å­¦çŸ¥è¯†çš„å‰æä¸‹ï¼Œä¹Ÿèƒ½ç”¨ç®€å•çš„ä»£ç å®ç°ä¸‰ç»´åœºæ™¯çš„æ¸²æŸ“ã€‚

è¦æƒ³åœ¨å±å¹•ä¸­å±•ç¤º3Då›¾åƒï¼Œå¤§è‡´æ€è·¯ï¼š

- ç¬¬ä¸€æ­¥ï¼šæ„å»ºä¸€ä¸ªç©ºé—´ç›´è§’åæ ‡ç³» ï¼šThreeä¸­ç§°ä¹‹ä¸ºåœºæ™¯(Scene)
- ç¬¬äºŒæ­¥ï¼šåœ¨åæ ‡ç³»ä¸­ï¼Œç»˜åˆ¶å‡ ä½•ä½“ï¼š Threeä¸­çš„å‡ ä½•ä½“æœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬BoxGeometryï¼ˆç«‹æ–¹ä½“ï¼‰ï¼ŒSphereGeometryï¼ˆçƒä½“ï¼‰ç­‰ç­‰
- ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©ä¸€ä¸ªè§‚å¯Ÿç‚¹ï¼Œå¹¶ç¡®å®šè§‚å¯Ÿæ–¹å‘ç­‰ï¼šThreeä¸­ç§°ä¹‹ä¸ºç›¸æœº(Camera)
- ç¬¬å››æ­¥ï¼šå°†è§‚å¯Ÿåˆ°çš„åœºæ™¯æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„æŒ‡å®šåŒºåŸŸ ï¼šThreeä¸­ä½¿ç”¨Rendererå®Œæˆè¿™ä¸€å·¥ä½œï¼ˆç›¸å½“äºæ‹ç…§ï¼‰

***ä»¥ä¸Šæ˜¯ThreeJSæ¸²æŸ“ç‰©ä½“çš„å›ºå®šå†™æ³•ï¼Œä¸ç†è§£çš„è¯è®°ä½ä¹Ÿè¡Œçš„ğŸ˜„***

> çƒä½“å…¨æ™¯æ‰€éœ€çš„å›¾ç‰‡ç´ æï¼ˆä¸‹å›¾ï¼‰ï¼šå®½æ˜¯é«˜çš„ä¸¤å€ï¼Œæ•°å€¼æ˜¯2çš„æ•´æ•°å€æœ€å¥½ï¼Œå»ºè®®å›¾ç‰‡å®½é«˜ä¸º2048px*1024pxï¼ˆåé¢å®ç°å…¨æ™¯ä¼šç”¨åˆ°å“ˆï¼‰

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/041f32f816d44a27b30d8ccffc63acb0~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

å…·ä½“ä»£ç å®ç°ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
<title>æ‰‹æŠŠæ‰‹æ•™ä½ åˆ¶ä½œé…·ç‚«Webå…¨æ™¯</title>
    <meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
</head>
<body>
<div id="wrap" style="position: absolute;z-index: 0;top: 0;bottom: 0;left: 0;right: 0;width: 100%;height: 100%;overflow: hidden;">
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.js"></script>
<script>
    const width = window.innerWidth
    const height = window.innerHeight
    const radius = 500 // çƒä½“åŠå¾„

    // ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåœºæ™¯
    const scene = new THREE.Scene()

    // ç¬¬äºŒæ­¥ï¼šç»˜åˆ¶ä¸€ä¸ªçƒä½“
    const geometry = new THREE.SphereBufferGeometry(radius, 32, 32)
    const material = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./img/1.jpeg') // ä¸Šé¢çš„å…¨æ™¯å›¾ç‰‡
    })
    const mesh = new THREE.Mesh(geometry, material)
    scene.add(mesh)

    // ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç›¸æœºï¼Œå¹¶ç¡®å®šç›¸æœºä½ç½®
    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 100)
    camera.position.x = 0  // ç¡®å®šç›¸æœºä½ç½®
    camera.position.y = 0
    camera.position.z = 100
    
    camera.target = new THREE.Vector3(radius, 0, 0) // è®¾å®šå¯¹ç„¦ç‚¹
    

    // ç¬¬å››æ­¥ï¼šæ‹ç…§å¹¶ç»˜åˆ¶åˆ°canvas
    const renderer = new THREE.WebGLRenderer()
    renderer.setSize(width, height) // è®¾ç½®ç…§ç‰‡å¤§å°

    document.querySelector('#wrap').appendChild(renderer.domElement) // ç»˜åˆ¶åˆ°canvas

    function render() {
        camera.lookAt(camera.target)   // å¯¹ç„¦
        renderer.render(scene, camera) // æ‹ç…§
        
        // ä¸æ–­æ¸²æŸ“ï¼Œå› ä¸ºå›¾ç‰‡åŠ è½½å’Œå¤„ç†éœ€è¦æ—¶é—´ï¼Œä¸ç¡®å®šä½•æ—¶æ‹ç…§åˆé€‚
        requestAnimationFrame(render)
    }
    render()
</script>
</body>

</html>

å¤åˆ¶ä»£ç 
```

æµè§ˆå™¨é¡µé¢æ•ˆæœï¼ˆè®°å¾—å¼€å¯æ‰‹æœºæ¨¡æ‹Ÿè°ƒè¯•ï¼‰ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cd5b1fdab664d638dda8fef0d98ff7c~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

### 2.2 åŸºç¡€çŸ¥è¯†ç‚¹

#### 2.2.1 ç»çº¬åº¦

***æœ¬æ–‡æ˜¯ä½¿ç”¨ç»çº¬åº¦æ¥æ“ä½œå…¨æ™¯ï¼Œéœ€è¦ç§‘æ™®ä¸€ä¸‹ç»çº¬åº¦çš„çŸ¥è¯†***

ç»çº¬åº¦æ˜¯ç»åº¦ä¸çº¬åº¦çš„åˆç§°ç»„æˆä¸€ä¸ªåæ ‡ç³»ç»Ÿã€‚ç§°ä¸ºåœ°ç†åæ ‡ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ç§åˆ©ç”¨ä¸‰åº¦ç©ºé—´çš„çƒé¢æ¥å®šä¹‰åœ°çƒä¸Šçš„ç©ºé—´çš„çƒé¢åæ ‡ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ ‡ç¤ºåœ°çƒè¡¨é¢ä¸Šçš„ä»»ä½•ä¸€ä¸ªä½ç½®ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fbff2da7605430a9a5377055e97fe22~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

å¦‚å›¾æ‰€ç¤ºï¼Œç»åº¦ï¼šlonï¼Œå–å€¼èŒƒå›´ï¼š[0,360]ï¼Œçº¬åº¦ï¼šlatï¼Œå–å€¼èŒƒå›´ï¼š[-90,90];

#### 2.2.2 ç»çº¬åº¦è½¬æ¢ä¸‰ç»´åæ ‡

çƒé¢çš„ç‚¹{lon,lat}ï¼Œå…¶ä¸­Rä¸ºçƒä½“çš„åŠå¾„ï¼Œæ±‚çƒé¢çš„ç‚¹çš„åœ¨ThreeJSçš„åæ ‡çš„ä½ç½®ä¸ºï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fbb92bb8f094ae795559dccfeb6130b~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

è§£ï¼š

X = R * cosï¼ˆlatï¼‰* sin( lon )
Y = R * sin( lat )
Z = R * cos( lat )*cos( lon )

***æ³¨ï¼šThreeJSä¸­é»˜è®¤çš„åæ ‡ç³»æ˜¯å³æ‰‹åæ ‡ç³»ï¼ŒXè½´ä¸ºå·¦å³ï¼ŒYè½´ä¸ºä¸Šä¸‹ï¼ŒZè½´ä¸ºå‰åã€‚***

### 2.3 ç”Ÿæˆå…¨æ™¯çš„æ­¥éª¤

åœ¨2.1çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ç»˜åˆ¶ä¸€ä¸ªçƒä½“ï¼Œç»˜åˆ¶å…¨æ™¯æ˜¯åœ¨å…¶åŸºç¡€ä¸Šè¦åšè°ƒæ•´ï¼š

- 1ã€å°†ç›¸æœºç§»åˆ°çƒä½“çš„çƒå¿ƒä½ç½®ï¼›
- 2ã€å°†å…¨æ™¯å›¾ç‰‡è´´åˆ°çƒä½“çš„å†…è¡¨é¢ï¼›

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

- ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼ˆSceneï¼‰
- ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä¸€ä¸ªçƒä½“ï¼Œå¹¶å°†å…¨æ™¯å›¾ç‰‡è´´åˆ°çƒä½“çš„**å†…è¡¨é¢**ï¼Œæ”¾å…¥åœºæ™¯ä¸­
- ç¬¬å››æ­¥ï¼šåˆ›å»ºä¸€ä¸ªé€è§†æŠ•å½±ç›¸æœºå°†cameraæ‹‰åˆ°**çƒä½“çš„ä¸­å¿ƒ**ï¼Œç›¸æœºè§‚çœ‹çƒä½“å†…è¡¨é¢
- ç¬¬äº”æ­¥ï¼šé€šè¿‡ä¿®æ”¹ç»çº¬åº¦æ¥ï¼Œæ”¹å˜ç›¸æœºè§‚å¯Ÿçš„ç‚¹

å…·ä½“ä»£ç å®ç°ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ åˆ¶ä½œé…·ç‚«Webå…¨æ™¯</title>
    <meta name="viewport" id="viewport" content="width=device-width,initial-scale=1,minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
</head>
<body>
    <div id="wrap" style="position: absolute;z-index: 0;top: 0;bottom: 0;left: 0;right: 0;width: 100%;height: 100%;overflow: hidden;">
    </div>
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.js"></script>
    <script>
        const width = window.innerWidth, height = window.innerHeight // å±å¹•å®½é«˜
        const radius = 50 // çƒä½“åŠå¾„

        // ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåœºæ™¯
        const scene = new THREE.Scene()

        // ç¬¬äºŒæ­¥ï¼šç»˜åˆ¶ä¸€ä¸ªçƒä½“
        const geometry = new THREE.SphereBufferGeometry(radius, 32, 32)
        geometry.scale(-1, 1, 1) // çƒé¢åè½¬ï¼Œç”±å¤–è¡¨é¢æ”¹æˆå†…è¡¨é¢è´´å›¾
        const material = new THREE.MeshBasicMaterial({
            map: new THREE.TextureLoader().load('./img/1.jpeg') // ä¸Šé¢çš„å…¨æ™¯å›¾ç‰‡
        })
        const mesh = new THREE.Mesh(geometry, material)
        scene.add(mesh)

        // ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç›¸æœºï¼Œå¹¶ç¡®å®šç›¸æœºä½ç½®
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 100)
        camera.position.x = 0  // ç¡®å®šç›¸æœºä½ç½®ç§»åˆ°çƒå¿ƒ
        camera.position.y = 0
        camera.position.z = 0

        camera.target = new THREE.Vector3(radius, 0, 0) // è®¾ç½®ä¸€ä¸ªå¯¹ç„¦ç‚¹
      

        // ç¬¬å››æ­¥ï¼šæ‹ç…§å¹¶ç»˜åˆ¶åˆ°canvas
        const renderer = new THREE.WebGLRenderer()
        renderer.setPixelRatio(window.devicePixelRatio)
        renderer.setSize(width, height) // è®¾ç½®ç…§ç‰‡å¤§å°

        document.querySelector('#wrap').appendChild(renderer.domElement) // ç»˜åˆ¶åˆ°canvas
        renderer.render(scene, camera)

        let lat = 0, lon = 0

        function render() {
            lon += 0.003 // æ¯å¸§åŠ ä¸€ä¸ªåç§»é‡
            // æ”¹å˜ç›¸æœºçš„å¯¹ç„¦ç‚¹ï¼Œè®¡ç®—å…¬å¼å‚è€ƒï¼š2.2.2ç« èŠ‚
            camera.target.x = radius * Math.cos(lat) * Math.cos(lon);
            camera.target.y = radius * Math.sin(lat);
            camera.target.z = radius * Math.cos(lat) * Math.sin(lon)
            camera.lookAt(camera.target) // å¯¹ç„¦

            renderer.render(scene, camera)
            requestAnimationFrame(render)
        }
        render()
    </script>
</body>

</html>

å¤åˆ¶ä»£ç 
```

æ•ˆæœï¼š

![Jietu20210527-172203-HD.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07563ed3ec154a8b8f30beda4fc27cec~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

è‡³æ­¤ï¼Œæˆ‘ä»¬å…¨æ™¯åˆ¶ä½œå·²ç»å®Œæˆäº†ï¼Œï¼ˆåªç»Ÿè®¡jsä»£ç ï¼šå…±*28è¡Œ*ä»£ç ,æˆ‘æ‰ä¸æ˜¯æ ‡é¢˜å…šå‘¢ï¼ŸğŸ˜ï¼‰ã€‚

## ä¸‰ã€å…¨æ™¯äº¤äº’åŸç†

### 3.1 æ‰‹åŠ¿äº¤äº’ä¹‹æ—‹è½¬

æ‰‹åŠ¿äº¤äº’ä¹‹æ—‹è½¬æŒ‡å•æŒ‡æ»‘åŠ¨æ“ä½œï¼Œè¿™ä¸æ»‘åŠ¨åœ°çƒä»ªçš„äº¤äº’æ˜¯ä¸€è‡´çš„ã€‚

å±å¹•åæ ‡ç³»ï¼Œå·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ŒXè½´ï¼šç”±å·¦å‘å³ï¼ŒYè½´ï¼šç”±ä¸Šåˆ°ä¸‹ï¼Œ æ‰‹æŒ‡åœ¨å±å¹•æ»‘åŠ¨ä¼šä¾æ¬¡è§¦å‘ä¸‰ä¸ªäº‹ä»¶ï¼štouchstartã€touchmoveå’Œtouchendï¼›eventå¯¹è±¡ä¸­è®°å½•äº†æ‰‹æŒ‡å±å¹•çš„ä½ç½®

![TeamTalk_IMG_2021-05-27-173217.jpg](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7590860632d24e02bff06888c1faed81~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

æ‰‹æŒ‡åœ¨å±å¹•æ»‘åŠ¨è¿‡ç¨‹ï¼š

- touchstartï¼šè®°å½•æ»‘åŠ¨èµ·å§‹çš„ä½ç½®ï¼ˆstartXï¼ŒstartYï¼‰
- touchmoveï¼šè®°å½•å½“å‰ä½ç½®ï¼ˆcurXï¼ŒcurYï¼‰ç›¸å‡ä¸Šä¸€æ¬¡ä½ç½®çš„å€¼ï¼Œè®¡ç®—å‡ºå¼§é•¿é™¤äºåŠå¾„ä¹˜ä»¥factorï¼Œè®¡ç®—å‡ºï¼ˆlonï¼Œlatï¼‰
- touchendï¼šæš‚æ—¶æ²¡æœ‰ç”¨çš„

***å…¶ä¸­ï¼šå¼§é•¿Rå€¼çš„æ˜¯å±å¹•çš„æ»‘åŠ¨è·ç¦»***![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fef79613f4c443d4a4ca53360d329862~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

é‚£ä¹ˆå•æŒ‡åœ¨å±å¹•çš„æ»‘åŠ¨ï¼Œç”±P1 (clientX1,clientY1)ç§»åŠ¨åˆ°P2 (clientX1,clientY1)é•¿åº¦ä¸ºï¼Œå¯¹åº”ç»çº¬åº¦å˜åŒ–ï¼š

```
distanceX = clientX1 - clientX2   // Xè½´æ–¹å‘
distanceY = clientY1 - clientY2   // Yè½´æ–¹å‘

// å…¶ä¸­Rä¸ºçƒä½“åŠå¾„ï¼Œæ ¹æ®å¼§é•¿å…¬å¼ï¼š
lon = distanX / R
lat = distanY / R
å¤åˆ¶ä»£ç 
```

ä»£ç å®ç°ï¼š

```JavaScript
// å¢åŠ touchäº‹ä»¶ç›‘å¬
let lastX, lastY       // ä¸Šæ¬¡å±å¹•ä½ç½®
let curX, curY         // å½“å‰å±å¹•ä½ç½®
const factor = 1 / 10  // çµæ•ç³»æ•°

const $wrap = document.querySelector('#wrap')
// è§¦æ‘¸å¼€å§‹
$wrap.addEventListener('touchstart', function (evt) {
    const obj = evt.targetTouches[0] // é€‰æ‹©ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
    startX = lastX = obj.clientX
    startY = lastY = obj.clientY
})

// è§¦æ‘¸ä¸­
$wrap.addEventListener('touchmove', function (evt) {
    evt.preventDefault()
    const obj = evt.targetTouches[0]
    curX = obj.clientX
    curY = obj.clientY

    // å‚è€ƒï¼šå¼§é•¿å…¬å¼
    lon -= ((curX - lastX) / radius) * factor // factorä¸ºäº†å…¨æ™¯æ—‹è½¬å¹³ç¨³ï¼Œä¹˜ä»¥ä¸€ä¸ªçµæ•ç³»æ•°
    lat += ((curY - lastY) / radius) * factor

    lastX = curX
    lastY = curY
})
å¤åˆ¶ä»£ç 
```

å•æŒ‡æ“ä½œæ•ˆæœï¼š![Jietu20210527-172203-HD.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf40592cc00f448abd7cd3179e2fe42d~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

ä¸Šé¢çš„ä»£ç å·²ç»åŠ ä¸Šå…¨æ™¯çš„å•æŒ‡äº¤äº’ï¼Œä½†æ˜¯ï¼Œç¼ºå°‘äº†æ—‹è½¬æƒ¯æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ ä¸€ä¸‹æƒ¯æ€§åŠ¨ç”»ï¼š

æ»‘åŠ¨æƒ¯æ€§å®ç°ï¼Œæ‰‹æŒ‡åœ¨å±å¹•æ»‘åŠ¨è¿‡ç¨‹ï¼š

- touchstartï¼šè®°å½•æ»‘åŠ¨èµ·å§‹çš„ä½ç½®ï¼ˆstartXï¼ŒstartY, startTimeï¼‰
- touchmoveï¼šè®°å½•å½“å‰ä½ç½®ï¼ˆcurXï¼ŒcurYï¼‰ç›¸å‡ä¸Šä¸€æ¬¡ä½ç½®çš„å€¼ï¼Œä¹˜ä»¥factorï¼Œè®¡ç®—å‡ºï¼ˆlonï¼Œlatï¼‰ï¼Œã€è§¦æ‘¸è·Ÿéšã€‘
- touchendï¼šè®°å½•endTime,è®¡ç®—æœ¬æ¬¡æ»‘åŠ¨è¿‡ç¨‹ä¸­çš„å¹³å‡é€Ÿåº¦ï¼Œç„¶åï¼Œæ¯å¸§å‡å»å‡é€Ÿåº¦dï¼Œç›´è‡³é€Ÿåº¦ä¸º0æˆ–è€…touchstartäº‹ä»¶è¢«è§¦å‘ ã€è§¦æ‘¸ç»“æŸè§¦å‘æƒ¯æ€§åŠ¨ç”»ã€‘

ä»£ç å®ç°ï¼š

```JavaScript
let lastX, lastY         // ä¸Šæ¬¡å±å¹•ä½ç½®
let curX, curY           // å½“å‰å±å¹•ä½ç½®
let startX, startY       // å¼€å§‹è§¦æ‘¸çš„ä½ç½®ï¼Œç”¨äºè®¡ç®—é€Ÿåº¦
let isMoving = false     // æ˜¯å¦åœæ­¢å•æŒ‡æ“ä½œ
let speedX, speedY       // é€Ÿåº¦
const factor = 1 / 10    // çµæ•ç³»æ•°ï¼Œç»éªŒå€¼
const deceleration = 0.1 // å‡é€Ÿåº¦ï¼Œæƒ¯æ€§åŠ¨ç”»ä½¿ç”¨

const $wrap = document.querySelector('#wrap')
// è§¦æ‘¸å¼€å§‹
$wrap.addEventListener('touchstart', function (evt) {
    const obj = evt.targetTouches[0] // é€‰æ‹©ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
    startX = lastX = obj.clientX
    startY = lastY = obj.clientY
    startTime = Date.now()
    isMoving = true
})

// è§¦æ‘¸ä¸­
$wrap.addEventListener('touchmove', function (evt) {
    evt.preventDefault()
    const obj = evt.targetTouches[0]
    curX = obj.clientX
    curY = obj.clientY

    // å‚è€ƒï¼šå¼§é•¿å…¬å¼
    lon -= ((curX - lastX) / radius) * factor // factorä¸ºäº†å…¨æ™¯æ—‹è½¬å¹³ç¨³ï¼Œä¹˜ä»¥ä¸€ä¸ªç³»æ•°
    lat += ((curY - lastY) / radius) * factor

    lastX = curX
    lastY = curY
})

// è§¦æ‘¸ç»“æŸ
$wrap.addEventListener('touchend', function (evt) {
    isMoving = false
    var t = Date.now() - startTime
    speedX = (curX - startX) / t    // Xè½´æ–¹å‘çš„å¹³å‡é€Ÿåº¦
    speedY = (curY - startY) / t    // Yè½´æ–¹å‘çš„å¹³å‡é€Ÿåº¦

    subSpeedAnimate() // æƒ¯æ€§åŠ¨ç”»
})

let animateInt
// å‡é€Ÿåº¦åŠ¨ç”»
function subSpeedAnimate() {
    lon -= speedX * factor // Xè½´
    lat += speedY * factor
    
    // å‡é€Ÿåº¦
    speedX = subSpeed(speedX)
    speedY = subSpeed(speedY)

    // é€Ÿåº¦ä¸º0æˆ–è€…æœ‰æ–°çš„è§¦æ‘¸äº‹ä»¶ï¼Œåœæ­¢åŠ¨ç”»
    if ((speedX === 0 && speedY === 0) || isMoving) {
        if (animateInt) {
            cancelAnimationFrame(animateInt)
            animateInt = undefined
        }
    } else {
        requestAnimationFrame(subSpeedAnimate)
    }
}

// å‡é€Ÿåº¦
function subSpeed(speed) {
    if (speed !== 0) {
        if (speed > 0) {
            speed -= deceleration;
            speed < 0 && (speed = 0);
        } else {
            speed += deceleration;
            speed > 0 && (speed = 0);
        }
    }
    return speed;
}
å¤åˆ¶ä»£ç 
```

é¢„è§ˆåœ°å€ï¼š[azuoge.github.io/Opanorama/](https://link.juejin.cn/?target=https%3A%2F%2Fazuoge.github.io%2FOpanorama%2F)

### 3.2 æ‰‹åŠ¿äº¤äº’ä¹‹ç¼©æ”¾

***æ‰‹åŠ¿äº¤äº’ä¹‹ç¼©æ”¾æ˜¯åŒæŒ‡æ“ä½œï¼Œè·Ÿæ”¾å¤§å›¾ç‰‡ä¸€æ ·ã€‚***

å‰é¢ä»‹ç»ThreeJSï¼Œæåˆ°è¿‡ç›¸æœºï¼Œå…¨æ™¯ç¼©æ”¾ä¹Ÿæ˜¯ä¾æ®ç›¸æœºæ‹ç…§æ—¶ï¼Œç¼©æ”¾æ‹æ‘„ç…§ç‰‡å†…å®¹çš„åŸç†æ˜¯ä¸€æ ·çš„ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c349949766a47acbd2fe13efc9f27e8~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

ä½¿ç”¨ThreeJSåˆ›å»ºç›¸æœºä»£ç å¦‚ä¸‹ï¼š

```javascript
const camera = new THREE.PerspectiveCamera( fov , aspect , near , fear )
å¤åˆ¶ä»£ç 
```

å‚æ•°è¯´æ˜ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbbdd5068ee54292931fd5aae306ada2~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

å…¶ä¸­ï¼Œ

- nearï¼šå–é»˜è®¤å€¼ï¼š0.1å³å¯
- fearï¼šåªè¦å¤§äºçƒä½“åŠå¾„å°±å¯ï¼Œå–å€¼ä¸ºï¼šçƒä½“åŠå¾„R
- aspectï¼šåœ¨å…¨æ™¯çš„åœºæ™¯å·²ç»ç¡®å®šäº†ï¼Œç…§ç‰‡çš„é•¿å®½æ¯”ï¼šå±å¹•å®½åº¦ / å±å¹•é«˜åº¦
- fovï¼šè§†åœºï¼Œç¼©æ”¾æ˜¯é€šè¿‡ä¿®æ”¹å®ƒçš„å€¼æ¥å®Œæˆå…¨æ™¯å›¾ç‰‡çš„ç¼©æ”¾ï¼›

***å…¶å®ï¼Œå¾ˆå¥½ç†è§£ï¼Œçå¤§çœ¼ç›ï¼Œæˆ‘ä»¬å°±çœ‹çš„è§†é‡å°±å¹¿ï¼Œçœ‹åˆ°ç‰©ä½“å°±æ˜¾å¾—å°äº›ã€ç¼©å°ã€‘ï¼Œåä¹‹ï¼Œçœ¯ç€çœ¼ï¼Œçœ‹åˆ°çš„è§†é‡å°±çª„ï¼Œçœ‹åˆ°ç‰©ä½“å°±æ˜¾å¾—å¤§ã€æ”¾å¤§ã€‘ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å³å›¾çš„ fov çš„å€¼æ¥ç¼©æ”¾å…¨æ™¯å›¾ç‰‡***

é‚£ä¹ˆå¦‚ä½•è®¡ç®—fovå‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åŒæŒ‡äº¤äº’ï¼ŒåŒè®¡ç®—ï¼Œå¼€å§‹è§¦æ‘¸è®¡ç®—ç¬¬ä¸€æ¬¡åŒæŒ‡çš„è·ç¦»ï¼Œåœ¨åŒæŒ‡ç§»åŠ¨ä¸­ä¸æ–­è®¡ç®—åŒæŒ‡è·ç¦»ï¼Œä¸ä¸Šä¸€æ¬¡è·ç¦»ç›¸é™¤å³ä¸ºç¼©æ”¾å€æ•°ã€‚

å…³é”®ä»£ç å¦‚ä¸‹ï¼š

```javascript
// å…¶ä¸­ï¼Œï¼ˆclientX1ï¼ŒclientY1ï¼‰å’Œï¼ˆclientX2ï¼ŒclientY2ï¼‰ä¸ºåŒæŒ‡åœ¨å±å¹•çš„å½“å‰ä½ç½®

// è®¡ç®—è·ç¦»ï¼Œç®€åŒ–è¿è¾“ä¸ç”¨å¹³æ–¹è®¡ç®—
const distance = Math.abs(clientX1 - clientX2) + Math.abc(clientY1 - clientY)
// è®¡ç®—ç¼©æ”¾æ¯”
const scale = distance / lastDiance 
// è®¡ç®—æ–°çš„è§†è§’
fov = camera.fov / scale

// è§†è§’èŒƒå›´å–å€¼
camera.fov = Math.min(90, Math.max(fov,60)) // 90 > fov > 60 ,ä»å‚æ•°è¯´æ˜ä¸­é€‰å–

// è§†è§’éœ€è¦ä¸»åŠ¨æ›´æ–°
camera.updateProjectionMatrix()

å¤åˆ¶ä»£ç 
```

ä½“éªŒåœ°å€ï¼š[azuoge.github.io/Opanorama/](https://link.juejin.cn/?target=https%3A%2F%2Fazuoge.github.io%2FOpanorama%2F)

### 3.3 æ‰‹æœºé™€èºä»ªäº¤äº’

html5äº‹ä»¶ä¸­ï¼Œdeviceorientationäº‹ä»¶ï¼Œæ­¤äº‹ä»¶æ˜¯æ£€æµ‹è®¾å¤‡æ–¹å‘å˜åŒ–æ—¶çš„äº‹ä»¶ã€‚

H5æœ‰ä¸¤ä»½åæ ‡ï¼š

- åœ°çƒåæ ‡ x/y/zï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯æ’å®šæ–¹å‘
- æ‰‹æœºå¹³é¢åæ ‡ x/y/zï¼šç›¸å¯¹äºæ‰‹æœºå±å¹•å®šä¹‰çš„æ–¹å‘

å–å€¼èŒƒå›´ï¼š

- Xè½´ï¼šä¸Šä¸‹æ—‹è½¬Beta(X) ,å–å€¼èŒƒå›´ï¼š[ -180Â° ï½ 180Â° ]
- Zè½´ï¼šå·¦å³æ—‹è½¬æ‰­æ›²Alpha(Z) ,å–å€¼èŒƒå›´ï¼š[ 0Â°ï¼Œ 360Â° ]
- Yè½´ï¼šæ‰­è½¬å¯ä»¥æ˜¯ Gamma(Y) ,å–å€¼èŒƒå›´ï¼š[ -90Â° ï¼Œ90Â° ]

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3451db133b4341bd98fa43659d5456b7~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

å½“å°†æ‰‹æœºå‚ç›´ï¼Œä¸”æ­£é¢ï¼ˆ90åº¦ï¼‰å†²ç€è‡ªå·±ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bba70ed38ce4314848bbf99dc516f34~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

ä»ä¸Šå›¾è§‚å¯Ÿï¼Œå¹¶ç»“åˆThreeJSçš„åæ ‡ç³»ï¼Œå¯ä»¥å¾—å‡ºå…³é”®ç»“è®ºï¼š

- latå¯¹åº” (beta - 90) * (Math.PI / 180) ã€è§’åº¦æ¢ç®—å¼§åº¦ã€‘
- lonå¯¹åº” gamma * (Math.PI / 180) ã€è§’åº¦æ¢ç®—å¼§åº¦ã€‘

è¿™alphaè§’åº¦å°±ä¸å†è¿™æ¬¡å…¨æ™¯äº¤äº’ä¸­ã€‚

å½“å°†å°†æ‰‹æœºå‚ç›´ï¼Œä¸”æ­£é¢ï¼ˆ90åº¦ï¼‰å†²ç€è‡ªå·±ï¼Œè½¬åŠ¨æ‰‹æœºæ–¹å‘æ¼”ç¤º

![Jietu20210530-104349-HD.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65d5d0dba64b49e7ad0dc4a52811941d~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

Chromeæµè§ˆå™¨æ˜¯å¯ä»¥å¼€å¯é™€èºä»ªæ¨¡æ‹Ÿï¼Œæ“ä½œå¦‚ä¸‹ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/816bde6f867247e3acb94a55326237b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

é‚£ä¹ˆä»£ç å°±å¾ˆç®€å•ï¼š

```javascript
// è§’åº¦æ¢ç®—å¼§åº¦å…¬å¼
const L = Math.PI / 180

// é™€èºä»ªäº¤äº’
window.addEventListener('deviceorientation', function (evt) {
    lon = evt.alpha * L
    lat = (evt.beta - 90) * L
})
å¤åˆ¶ä»£ç 
```

æ•ˆæœå¦‚ä¸‹ï¼š

![Jietu20210530-112850-HD.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ee82aad63534913bde072124a57061d~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šH5è·å–çš„æ‰‹æœºæ–¹å‘æ•°å€¼ï¼Œåœ¨éƒ¨åˆ†androidæ‰‹æœºï¼Œå­˜åœ¨æ˜æ˜¾çš„æŠ–åŠ¨ï¼Œå°±ç®—æ‰‹æœºé™æ­¢æ”¾åœ¨æ¡Œé¢ä¸Šï¼Œé™€èºä»ªè¾“å‡ºçš„æ•°æ®ä¹Ÿä¼šæŠ–åŠ¨ï¼›ï¼ˆè¯¥é—®é¢˜ä¸å±äºåŸç†ï¼Œåªæ˜¯åœ¨å…¨æ™¯åº”ç”¨è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜ï¼Œä¸æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è·³è¿‡ğŸ˜„ï¼‰

![Jietu20210530-112405-HD.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7417c78a2844012b41b36cb13284ae4~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

æˆ‘ä»¬éœ€è¦å¯¹é™€èºä»ªçš„è¾“å‡ºçš„æ•°å­—åšå¤„ç†ï¼Œè¿™é‡Œé‡‡ç”¨ä¿¡å·ä¼ è¾“ä¸­ä½¿ç”¨çš„ ***ä½é€šæ»¤æ³¢ç®—æ³•***

å…¬å¼å¦‚ä¸‹ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/341d2227b8154827b0b48c095a1354b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)***å½“K=1æ—¶ï¼Œå°±æ˜¯çœŸå®çš„æ•°æ®ï¼Œå°äº1ï¼Œå°±å¯ä»¥ç¨€é‡Šå˜åŒ–å€¼ã€‚***

ä½†æ˜¯åˆæœ‰äº†æ–°çš„é—®é¢˜ï¼š**çµæ•åº¦å’Œå¹³ç¨³åº¦çš„çŸ›ç›¾**

- æ»¤æ³¢ç³»æ•°è¶Šå°ï¼Œæ»¤æ³¢ç»“æœè¶Šå¹³ç¨³ï¼Œä½†æ˜¯çµæ•åº¦è¶Šä½
- æ»¤æ³¢ç³»æ•°è¶Šå¤§ï¼Œçµæ•åº¦è¶Šé«˜ï¼Œä½†æ˜¯æ»¤æ³¢ç»“æœè¶Šä¸ç¨³å®š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/898fa99bc0c148789d0bfe5ad5567355~tplv-k3u1fbpfcp-zoom-in-crop-mark:652:0:0:0.awebp)

é€šè¿‡ç»Ÿè®¡æ•°æ®å¾—å‡ºçš„ç»“è®ºï¼Œ Kå–å€¼ä¸º10ï¼Œçµæ•åº¦å’Œå¹³ç¨³åº¦è¡¨ç°è¾ƒå¥½ã€‚

ä½“éªŒåœ°å€ï¼š[azuoge.github.io/Opanorama/](https://link.juejin.cn/?target=https%3A%2F%2Fazuoge.github.io%2FOpanorama%2F)

### 3.4 æ‰‹åŠ¿å’Œé™€èºä»ªäº¤äº’ç»“åˆ

æ‰‹åŠ¿å’Œé™€èºä»ªçš„äº¤äº’éƒ½è½¬åŒ–æˆ**ç»çº¬åº¦**æ¥é©±åŠ¨å…¨æ™¯ï¼Œé‚£ä¹ˆï¼Œä¸¤è€…ç»“åˆä¹Ÿå°±å¾ˆç®€å•äº†ã€‚

å…·ä½“æ€è·¯å¦‚ä¸‹ï¼š

```
lat = touch.lat + orienter.lat + fix.lat    // å–å€¼èŒƒå›´ï¼š[-90,90]
lon = touch.lon + orienter.lon + fix.lon    // å–å€¼èŒƒå›´ï¼š[0,360]
å¤åˆ¶ä»£ç 
```

*å…¶ä¸­ï¼Œtouchä¸ºæ‰‹åŠ¿å½±å“ï¼Œorienrerä¸ºé™€èºä»ªå½±å“ï¼Œfixä¸ºä¿®æ­£å› å­ï¼Œä¿è¯ç»çº¬åº¦åœ¨æ¢ç®—çš„ç»“æœå§‹ç»ˆç¬¦åˆå–å€¼èŒƒå›´ã€‚*



æœ¬æ–‡å®Œæ•´çš„ä»£ç æ”¾åœ¨ï¼š[ https://github.com/azuoge/Opanorama](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fazuoge%2FOpanorama)ï¼Œæ¬¢è¿æŸ¥é˜…å’Œè®¨è®ºã€‚





## æˆ‘çš„è¡¥å……

ä¸‹é¢æ˜¯ä¸€äº›ä¸ªäººæ„è§ï¼Œä»…ä¾›å‚è€ƒã€‚

1. å…³äºæ—‹è½¬äº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„äº‹ä»¶ï¼Œå¦‚æ­¤å…¼å®¹PCå’Œç§»åŠ¨ç«¯

   ```vue
    @pointerdown='onPointerDown' @pointermove='onPointerMove' @pointerup='onPointerUp'
   ```

2. å…³äºç¼©æ”¾äº¤äº’ï¼Œç”¨scaleå›ºç„¶æ²¡é”™ï¼Œä½†æ˜¯è¿™ä¸ªé‡ä¸å¥½æŠŠæ¡ï¼Œåœ¨å›ºå®šå¥½çƒä½“çš„å¤§å°çš„æƒ…å†µä¸‹ï¼Œæ›´æ¨èç›´æ¥ä½¿ç”¨å›ºå®šæ¯”ä¾‹ç¼©æ”¾ï¼Œå¦‚ä¸‹ï¼š

   ```javascript
   const methods = {
       // é¼ æ ‡æ»šè½®ç¼©æ”¾
       onMouseWheel (event) {
           const fov = camera.fov + event.deltaY * 0.05
   		// åˆ©ç”¨three.jså†…ç½®å‡½æ•°
           camera.fov = THREE.MathUtils.clamp(fov, 10, 75)
           camera.updateProjectionMatrix()
       },
       // ä¸‹é¢æ˜¯åŒæŒ‡ç¼©æ”¾
       onTouchStart (event) {
           if (event.targetTouches.length !== 2) return
   
           isUserInteracting = true
       },
       onTouchMove (event) {
           if (event.targetTouches.length !== 2) return
           event.preventDefault()
   
           // è¿™é‡Œç”¨çš„æ˜¯æ°´å¹³æ–¹å‘ä¸Šçš„åˆ¤å®šï¼Œå‚ç›´æ–¹å‘åŒç†
           const clientX1 = event.targetTouches[0].clientX
           const clientX2 = event.targetTouches[1].clientX
   
           const distance = Math.abs(clientX1 - clientX2)
           const fov = camera.fov + (distance > lastDiance ? -1 : 1) * 2
   
           // è§†è§’èŒƒå›´å–å€¼
           camera.fov = Math.min(90, Math.max(fov, 10)) // 90 > fov > 10 ,è¿™é‡Œé™åˆ¶fovçš„å¤§å°èŒƒå›´
   
           // è§†è§’éœ€è¦ä¸»åŠ¨æ›´æ–°
           camera.updateProjectionMatrix()
   
           lastDiance = distance
       },
       onTouchEnd (event) {
           isUserInteracting = false
       }
   }
   ```

3. æƒ¯æ€§æ§åˆ¶æˆ‘è¿™é‡Œæ²¡æœ‰æˆåŠŸå®ç°ï¼Œæœ‰å¾…æ·±å…¥ç ”ç©¶ã€‚